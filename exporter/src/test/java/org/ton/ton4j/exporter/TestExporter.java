package org.ton.ton4j.exporter;

import static org.assertj.core.api.Assertions.assertThat;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.ToNumberPolicy;
import java.io.File;
import java.io.IOException;
import java.util.TreeMap;
import java.util.stream.Stream;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.io.FileUtils;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.JUnit4;
import org.ton.ton4j.address.Address;
import org.ton.ton4j.cell.*;
import org.ton.ton4j.exporter.types.*;
import org.ton.ton4j.tlb.Account;
import org.ton.ton4j.tlb.Block;
import org.ton.ton4j.tlb.adapters.*;
import org.ton.ton4j.utils.*;

@Slf4j
@RunWith(JUnit4.class)
public class TestExporter {

  public static final String TON_DB_ROOT_PATH =
      "/home/neodix/gitProjects/MyLocalTon/myLocalTon/genesis/db";

  public static final Gson gson =
      new GsonBuilder()
          .setObjectToNumberStrategy(ToNumberPolicy.LONG_OR_DOUBLE)
          .registerTypeAdapter(byte[].class, new ByteArrayToHexTypeAdapter())
          .registerTypeAdapter(TonHashMapAug.class, new TonHashMapAugTypeAdapter())
          .registerTypeAdapter(TonHashMapAugE.class, new TonHashMapAugETypeAdapter())
          .registerTypeAdapter(TonHashMap.class, new TonHashMapTypeAdapter())
          .registerTypeAdapter(TonHashMapE.class, new TonHashMapETypeAdapter())
          .disableHtmlEscaping()
          .setLenient()
          .create();

  @Test
  public void testExporterBuilder() {
    Exporter exporter = Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).build();
    assertThat(exporter).isNotNull();
    log.info("exporter root db path {}", exporter.getDatabasePath());
  }

  @Test
  public void testExporterArchiveStats() throws IOException {
    Exporter exporter = Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).build();
    assertThat(exporter).isNotNull();
    log.info("exporter root db path {}", exporter.getDatabasePath());
    exporter.printADbStats();
  }

  @Test
  public void testExporterToFile() throws IOException {
    Exporter exporter =
        Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).showProgress(true).build();
    assertThat(exporter).isNotNull();
    FileUtils.deleteQuietly(new File("local.txt"));
    exporter.exportToFile("local.txt", true, 20);
  }

  @Test
  public void testExporterToFileNotDeserialized() throws IOException {
    Exporter exporter =
        Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).showProgress(true).build();
    assertThat(exporter).isNotNull();
    FileUtils.deleteQuietly(new File("local.txt"));
    exporter.exportToFile("local.txt", false, 20);
  }

  @Test
  public void testExporterToStdout() throws IOException {
    Exporter exporter = Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).build();
    exporter.exportToStdout(false, 20);
  }

  @Test
  public void testExporterToObjects() throws IOException {
    Exporter exporter =
        Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).showProgress(true).build();

    Stream<ExportedBlock> blockStream = exporter.exportToObjects(true, 20);

    blockStream.forEach(
        b -> {
          // insert block to your DB
          log.info(
              "block {}, txs {}, msgs {}",
              b.getSeqno(),
              b.getBlock().getAllTransactions().size(),
              b.getBlock().getAllMessages().size());
        });
    blockStream.close(); // to delete status file
  }

  @Test
  public void testExporterGetLast() throws IOException {
    Exporter exporter = Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).build();

    long startTime = System.currentTimeMillis();

    Block latestBlock = exporter.getLast();

    long durationMs = System.currentTimeMillis() - startTime;

    log.info("received last block : {}ms", durationMs);

    log.info("Latest block found:");
    log.info("  Workchain: {}", latestBlock.getBlockInfo().getShard().getWorkchain());
    log.info(
        "  Shard: {}",
        latestBlock.getBlockInfo().getShard().convertShardIdentToShard().toString(16));
    log.info("  Sequence Number: {}", latestBlock.getBlockInfo().getSeqno());
    log.info("  Timestamp: {}", latestBlock.getBlockInfo().getGenuTime());
    log.info("block {}", latestBlock);
    Gson gson =
        new GsonBuilder()
            .setObjectToNumberStrategy(ToNumberPolicy.LONG_OR_DOUBLE)
            .registerTypeAdapter(byte[].class, new ByteArrayToHexTypeAdapter())
            .create();
    log.info("blockGson {}", gson.toJson(latestBlock));
  }

  @Test
  public void testExporterGetLastWithLimit() throws IOException {
    Exporter exporter = Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).build();
    long startTime = System.currentTimeMillis();

    TreeMap<BlockId, Block> latestBlocks = exporter.getLast(10);

    long durationMs = System.currentTimeMillis() - startTime;

    log.info("received last block : {}ms", durationMs);

    latestBlocks.forEach(
        (blockId, block) -> {
          log.info("blockId {}", blockId);
        });
  }

  @Test
  public void testExporterGetAccountByAddress() throws IOException {
    Exporter exporter = Exporter.builder().tonDatabaseRootPath(TON_DB_ROOT_PATH).build();
    Address testAddress =
        Address.of("-1:6744E92C6F71C776FBBCEF299E31BF76F39C245CD56F2075B89C6A22026B4131");
    long startTime = System.currentTimeMillis();

    Account account = exporter.getAccountByAddress(testAddress);
    log.info("received account : {}ms", System.currentTimeMillis() - startTime);
    log.info("balance {}", Utils.formatNanoValue(account.getBalance()));

    assertThat(account).isNotNull();
  }

  @Test
  public void testShouldDeserializeBlock() {
    Cell c =
        CellBuilder.beginCell()
            .fromBoc(
                "b5ee9c72e202014b000100002b590000002400d000ee0184021e02ba03560374038603f2045e04aa04c0059605b005ca066c070e07b007ca07e008b609260940095a09fc0a160ab80b5a0bfc0c520c5c0c6c0c7a0cd00d220d360d4a0da20e520e6c0e860ea00eba0ed40eee0f060f1e0f360f4e0f660f7e0f960fae0fc60fde102a1044105e1078109210aa10c210da10f01106111c11321148115e1178119211ac11c611e011fa1214122c1244125c1274128c12a412bc12d412ec13381352136c138613a013ba13d413ee1406141e1436144e1466147e149614ae155015cc1668168216cf16e81735174e179b17b418011818186518b118c818e0192d1944199119dd19f41a0c1a591a701abd1ad41b211b6d1b841b9c1be91c8a1cd71d521da61dc01e0d1e591e721e8c1ed91f251f3e1f8b1fa21fef20062053206a20b720ce20e62133217f219621e321fa2247225e22ab22c22364237a23f6249024dd25292542258f25a825f5260e265b26a726c026da27272740278d27a627f3280a285728a328ba28d2291f296b2982299a29e72a332a4a2a622aaf2ac62b132b2a2b772c182c652ce02dc32e162e302e7d2e962ee32f2f2f482f952fae2ffb30143061307a309430e130f83145315c31a931c0320d32593270328832d532ec33393385339c33b4340134a234ef356a36063653366836c836de36f33708371e377c37da382c388a389a38ee3942399639aa39bf39d23a2b3a3e3a533b5d3b703c243ccc3d7c3e3f3e483ecf3ee63ff1400240124098415f416c41f2420e42f74300437044124486454b455445da45fa469846f84706478d47ae47bc47c647d0488548f249c14a624ad64ae44b6b4b8e4c494c524d074dc54dd24e864f164f334f404f4e4f6e4f7c4f8a504a5060506e507c517a52825320539453a6542055005588559d563e56b2041011ef55aaffffff11000100020003000402a09bc7a98700000000840100033ce9000000000000000000000000000000000068bd88c100000038b1134a4000000038b1134a4969ddb8f30000055200034ce100034b30c40000000b00000000000003ee000500060211b8e48dfb43c89c7494000700080a8a04fa2dca72328883f4ae44d7878435240d41e74430c3bde8da4438a443856c20d5c2162992044ba0ef857304ee244ddd13aa33103a11e9fc6e03dc843a8a98bd07002000200009000a03894a33f6fd9d1b3c0e1c47ac2b24a252023b4ed90ac27326e2e42ccad7e55f4197076077569b5b8927e63670d8a3207158a35284c7e2ec7209d0a5bb7890a203c9e2d965ba40001e001f0020009800000038b104080400034ce1dcc1a72718f902e8b814dbd490b2fbc399e1503d2bf71b479c3610a47c7ea437c742ce513f7b7cd79b746e8493a8b4485054a3de89b375ddd20505c6457261b9009800000038b104080100033ce8bf2e8cb0cd9ced81c1419da44ca6052013cff124afd6ea95a2dc4aab871b3009b95a4d4cbae08d1b8acc8a1755fc3f4c7c762e941a9ec5237b71fd75cd13c52800195da4aea9e932ed24fdd0a50008000d0010ee6b280008235b9023afe2ffffff110000000000000000000000000000033ce80000000068bd88c000000038b104080100034ce020000b000c000d235b9023afe2ffffff110000000000000000000000000000033ce90000000068bd88c100000038b1134a4900034ce12000130014001528480101469e22db7b91f12a1cb41c948fd342dc79c6261ce39fe3c1328a5a6cf0d7de920001210d817692baa7a4d0000e00d10000000007000000fffffffff83fffff5da4aea9e93360b3dcbc96f5900000038b0f4c5c400034ce0961e3614eff064b25075ca25777c67f74147ccb171a51a317443db7876d046eccf486e8907cb6a00e8fd8caa4a6a641b644eabd13a9adce2c8c33aaf6da902f98220d00bb495d53d268000f0010220d00ad2fc3a2c06800110012320db48783e7d4ef0eb03938d5eb499a55b95fbdecfd95602a3382f14cc79f734f6731f0302239d510b6def07ff5c4c50b9cebc55c3f93eec11504714bacf2cc0453001d001300ae1999b11208005700cf320d5ba5835ef5bfa6407f19a6e1fbe1c27ab78370fc06dc1b413b862c20b4821e1e9789c56b68e149dbfb6e495b8447ce2482ea3b572f8ff62b235c19b6c8aec9c4001b001000a679f3bc850800280029320d484d1a49182b720a5ad650a1c7c95bc48ce47e083455507f0e10c5d706c0c475bc3764b620652b7448278952f2e5d9fa2fb76b7d38a479d8ae1edf26065e4f30001b001100a6b5cfe63b68004600aa01110000000000000000500016210d8176927ee85290001700d1000000000e000000fffffffff07fffff5da49fba14a360b3fb017a9a100000038b104080400034ce1dcc1a72718f902e8b814dbd490b2fbc399e1503d2bf71b479c3610a47c7ea437c742ce513f7b7cd79b746e8493a8b4485054a3de89b375ddd20505c6457261b98006bb040000000000000000001a6708000001c5889a5238e278d888c6aad6cc86e44413d335d487b0399ffebf495cbba9d04e653da1a1cc0220d00bb493f74294800180019220d00ad2fa5c31808001a001b320d04ec4cc6eeccf13749198a1f2f09c6a06857e8c0381ac3020ddcbaf69236f2876f05f9c2eae02beb7f41819be8670031061c35e9bbed406a911b2039bf1e6e9b001d001300ae1999b1114800ce00cf220d00a67a16668da8001c001d320d6f9719161e135c27194ed7eb0eea5310f6a96ff0089ffd146d02a3a8099cdc92cccf922cf82abaf4fdb261e4f0cc09995f9dd282e93fc70d308ac8ecd56823a6001b001300a6b58f5c8a6800a900aa320df4357eb46e7577a9141711086517e3b2356dd243a3fccb261284ef68693dddb1bc1c9ae58421d365606834f696b69ab848cd37c4023e52111a537d0e39fd014b001a001100a325e4ae04680069006a320def709685e989e320ef9002f08a8d0c099900fcacc9b1ceecf60d70468559ae1e777495f012f63e57a022f058d2ad203b2e476c6eacfaa9f3d6a17fdf29860824001a001100a35431b889480089008a11099f14cb32ad0a50aff5a95c51e74e80ab93050e252f8ece7f8c15965f147dc410001199eb8a602000f1010182002101079d8c5fea0025020101002200230345bfce278d888c6aad6cc86e44413d335d487b0399ffebf495cbba9d04e653da1a1c814000f4010e00241201c6ab36a048c76cdbcb6f3cc4f68ef78122accf67681faac8258cb1d767dfd791000f0100fb00fc02076608235b00f4011b02070ec62ff50026002712071af362ae0d7da3e4d251c7a28beae208196bf29cd19b6266314f7ce17c854b36000e0d9e8ef50106010702a4bfcf090f84b12533a5e6d52d12ea1823c6607ce57ff9ee3514c9ca758100dbc2989a4f4201678487c2589299d2f36a9689750c11e3303e72bffcf71a8a64e53ac0806de14c6800000007162269486693d0800105012d220d00a325e4ae0488002a006a220d00a3540f0e80880039008a220d00a1d19c8362a8002b006c220d00a0dc47f1c7a8002c006e220d00a07f084710c8002d0070220d00a04a400ab928002e0072220b009e842970880073002f220b009b58b150c800300076220b0096817f8cc800310078220b008ee3dd184800790032220b008c91c951080033007c220b008772017fe80034007e220b008770abb3e800350080220b0087707adfe800810036220b0087701937e800370084220b00876fe863e8003800862848010174286a543479fe907011af499c653784369bf359de9f441540c917c54dc44bab0002220d00a18c91842ce8008b003a220d00a0ae63a040c8003b008e220d00a04aa0526f48008f003c220d00a021ae5838880091003d220b0094812692a80093003e220b008d75625ac80095003f220b0080ebd50b8800970040220900790be9c80041009a22090066ddd008009b004222090064016408009d004322090062191c08009f004422090060f4240800a1004522095018186a0200a700a8220d00a377b62f61c8004700ac220d00a1e9fbd305a8004800ae220d00a0cf7277a82800af0049220d00a06384cb3b28004a00b2220d00a0493f5fe768004b00b4220d00a024c204a248004c00b6220d00a0245851d688004d00b8220b0090d4b4b3c800b9004e220b008bee9d3f88004f00bc220b008be9d88b8800bd0050220b008be72cf388005100c0220b008be607fb8800c10052220b008be4b22f88005300c4220b008be4508788005400c6220b008be41fb388005500c8220b008be3eedf88005600ca284801013934e38b726c128a06c44da8d39a0e084d6b63d6d39760a1f9d4eb08239e296d0002220d00a79f2f16cd68005800d1220d00a3ed6c4d038800d20059220d00a22dae17260800d4005a220d00a14a83fc724800d6005b220d00a0c6a492d6c800d8005c220d00a074a0a304c8005d00db220d00a030c680a488005e00dd220b0088132a8288005f00df220b00850d07d128006000e1220b008096ec53a800e20061220b00808406a1e8006200e5220b00808097b9e8006300e7220b00807f1119e800e80064220b00807eaf71e8006500eb220c600807e1cf5e006600ed2199bb7e12c494ce979b54b44ba8608f1981f395ffe7b8d4532729d604036f0a620403ef610f3a40c7c751b1298eb1f9b678fc032eba0355aa151275cf249f6cf77b30b780450000001c580050e2c00067226fc009e121f09624a674bcdaa5a25d430478cc0f9cafff3dc6a299394eb0201b785312288684c345ec4558000000e2c002871d00fbd843d34000f00068219365b677accc800800885413f8ba437c23bae763cc42735f3705e48a9bffd5af1189082c6e46dbc4250012ccd292f7f05e96eead87c40f298af0861c8177119742adbc6a5fd88fe93353a000f0220d00a1d19c836288006b006c284801015a0050778a7127333de8a6ee64fc4eacec3712ac6686b4ec0c2ff4e17e5412280018220d00a0dc47f1c788006d006e2848010132b04ad8e86b8c5e8509214cd112818a392534ca9087f35f5efb3bd71d8d53b60018220d00a07f084710a8006f007028480101a21b23677f33f096792b9350e4a3c53340266c22b147e0ebb981f9431d79cb860016220d00a04a400ab90800710072284801017df495962963b9fb81ee01eb3b6c70fc53f20c3ee20a00b0a5ac031a76dcf4830015220b009e8429706800730074284801018c8836d65c24128ef9d30263f8eff9b2540c874158e642f4ae64ef98e5eaa003001228480101304b1d5f02b8e10ea2fa3d394023e78a00ed02a9217ddc3d7fa0b175a35368950011220b009b58b150a800750076220b0096817f8ca8007700782848010146c866ce8d0ba1120588506cd80f9308ba4eda49d3744b6a499aace59a6eb5fe0011220b008ee3dd18280079007a28480101bebcbbc79924eed3d6b59df21d84c30b60b494a1c9ce18b81923a9f55c79fa9e000f28480101508628fb75b9922e10a777029191e1bec896cab454a9facfb62437c73ce6b949000f220b008c91c950e8007b007c220b008772017fc8007d007e28480101fa428c6afc1395d0a14516f9376de3537db48f9f0923a11039e44eeb1a2ab703000c220b008770abb3c8007f0080284801010de7aa6a14124026e8746c58ad9fb8d478b75a06f60dbb0454f2ee589d6e3a660004220b0087707adfc80081008228480101ef9801ccab22d65ce117abf8f7651a55032af965f11769c03f2ba0c568cc7474000128480101cab4aa96adfacd8adab418f3b0740f0114da70b4b1a1cb1809e351009a80852f0002220b0087701937c800830084220b00876fe863c800850086284801018198fc19544b582d457b4a9eb75235b220b1673745e3bc4535871cf65ae2a16400010199bb94d38db320e670ed8efc47d865bfc1d468571a1ac266e2fb431493ea0e5f021dbede3f36c1f944c275e09ea370fc76a6e91078afb7ffca85fea37ee6a6879222041d110000000e2c44d291e0008728480101c9021f8f7f2d6dc37cc0bd60fae31aaf54203763666605817db55d7c62045d880001026fc00009114d38db320e670ed8efc47d865bfc1d468571a1ac266e2fb431493ea0e5f2068148c345ec4608000000e2c44d29210edf6f1f934000cc00880050000000014dd9541043d2c5f9abd426d365433fca31566253b472cd78060496a887d354e11f6fa931220d00a18cb42e35a8008b008c284801015bbdd105c9aecb4ad0e07b716809615ce1822d893bf3dc43fb518674a2cfe77e00182848010112be4f1e796d9fa315bbe8ac3844af980a779ea0b82d62ffa7a247a362e612080018220d00a0ae864a4988008d008e220d00a04ac2fc7808008f009028480101aefb5f1c13b9d42203605baf01a3b1284cda32b3e10263e067ff2062c8435974001628480101558a732d4e1b2f72712b7349b2d914333c5446173aa336152a5bd0cb732c32360015220d00a021d10241480091009228480101747161d206f90248688f0899a15f1c98f517fa0ed5017466eb76dad5a06a19700014220b0094a3d09b680093009428480101dedd9615f7aaeb2a3f64a9436b44787aba6304d4d545f77f21c46d94432f3cb90011220b008d980c6388009500962848010186c021a4cde5b43b11bf8e8d4943c95b1d2f3c7e2bbc8f4d2bf54fdd0c19a0510010220b00810e7f144800970098284801015b98c37dc1b19c25c549cb639bd9ff21fa576e12671009edecb6069779a2b668000f220b00803bb5f2880099009a220b00802987d8c8009b009c28480101fa691ad75fab7343b53dea57aec50c263e1ac7c22656c95e06003a8f6dbe1e28000928480101852d6caf1d26b5515f0cf76647a96b760b29fdd58bc82082a630c7554bf03c440007220b008026ab6cc8009d009e2848010103be669ad9a757a33356954e0459246b74cda8801bc8a7ce26caf176044a18120006220b008024c324c8009f00a0284801011ea7f1e06dfca2ce13ec9ac6c605a298bedab1b668b3552078534f20ef31c5900004220b0080239e2cc800a100a228480101f9190e358e4f77597ff3ec02257aea7f435ef34d7f577c2997de69badc677bb40003220b0080230bb0c800a300a42199bbdb4da5e1bcedb5b5a0ed6257cf0f4c9ddc17c9febcf63bef8906ab86ea86010045541187c9fb71cdcc344b4c1a6f21dd187972cc4b66601c71a3fa527a6114be7e7b8d2000000716226948b000a52209006061a80800a700a8226fc002bef369b4bc379db6b6b41dac4af9e1e993bb82f93fd79ec77df120d570dd50c2288682c345ec4608000000e2c44d292100455411934000f000a6219156760765800800012229a71b6641cce1db1df88fb0cb7f83a8d0ae343584cdc5f6862927d41cbf0012ccd292f7f05e96eead87c40f298af0861c8177119742adbc6a5fd88fe93353a000f028480101fcee663a0101283e0d0351ba796f2bfc3486ccd377849ea17c6d52401057ad8f00012848010146041acb62e66e7d7021b07bf6a50ac01c4fbef34fedab09588cb1f6399b34600001220d00a37775a5b0c800ab00ac2848010145f78aaef3bbb2118999e0013e69d45e75b620917d5a8c2e8b9c2eab26908abd001a220d00a1e9bb4954a800ad00ae2848010136cd4f6a4560fc3e664c408a4364d38c082e2ab975b9b466d96ce85f5bdc15d50019220d00a0cf31edf72800af00b028480101d8d119f2bd4eadf2d0f9223c483f5d16db5a41294205aba86b6da9da0841fe600018284801013db465e41e21e7bad0fd0a12c1801c9b627552e6f225ae244ed873c77bc1e0e90015220d00a06344418a2800b100b2220d00a048fed6366800b300b4284801018ed02a5976ded598c75a3c59b4e505690af92e6fef4249a9e9ad521f4ab6004c0015220d00a024817af14800b500b6284801018ce422bb91e8be22b8854e579932f0756e6522a5ce49c94663cd290060e6fc7d0013220d00a02417c8258800b700b828480101c96574ffc087058e9b12d9583ef11593c064ed60a8444e097a4c3337a729725c0010220b0090942b02c800b900ba28480101f551c438f6bfbab24e52e5be5c1ee4b9697d3ec6251268e71c77eadbdfdd30950011284801011393bce0dcf2d4737a8101c7dcdf268fd00cba7ecd372386158dacc01cd71d640010220b008bae138e8800bb00bc220b008ba94eda8800bd00be2848010196cf880339f0b950602f87941b57eede356effff4e603f6d19a2453e4f1ec4160008284801018cde2d59dd573655eabe6d6348accd412194608c534ba81efe2ebb97ec94eb7f0006220b008ba6a3428800bf00c0220b008ba57e4a8800c100c2284801015df1f8060a743d5e692f81068ed41b0e66560e17502fb932de22743dee175ec7000428480101ebda5dcd5118ee7eac002358ce6ad9c75d772c30c90a61f678b860376a04ff970005220b008ba4287e8800c300c4220b008ba3c6d68800c500c6284801016ac19cdd3de654d529b2855b9a43a6b0ecdc81cfac856ec5d6af5d4d5ff4cf660002220b008ba396028800c700c828480101124ba4cf043dfce03260bc9a5026368d65c0d828588abead8f7b44f055178fe20001220b008ba3652e8800c900ca28480101c257b557fa6d9b9635d99315203de1dfb4f0ae9b852a55995c2f2f772d33673a00010199bb53f8ba437c23bae763cc42735f3705e48a9bffd5af1189082c6e46dbc424045d19a2d4062f1b2858d4474def197d25a944a7811a830ac901f5472c4f76b48bc42c5fc30000001c5889a5244000cb28480101994b11a0737b6d4e3ea60c273ff5ac5909ce7bf51f19c5ed8ac515909a9fd75a0001026fc00442a09fc5d21be11dd73b1e62139af9b82f2454dffead788c4841637236de2122068148c345ec4608000000e2c44d2925174668b5134000cc00cd00deff0020dd2082014c97ba218201339cbab19f71b0ed44d0d31fd31f31d70bffe304e0a4f2608308d71820d31fd31fd31ff82313bbf263ed44d0d31fd31fd3ffd15132baf2a15144baf2a204f901541055f910f2a3f8009320d74a96d307d402fb00e8d101a4c8cb1fcb1fcbffc9ed5400500000000601e5814380b13fe258537ed62cdea606c5f9da946f84b6745ca5a4f34f7592bf34045492220d00a79f2f16cca800d000d128480101e1540a2a8f6d0736f3cc4a77ff154819b3941c39dee3f544f1afc79fb7a56e82001b220d00a3ed6c4d02c800d200d328480101950c78a1c496c30cf6e2874961d8b2fe286d57db503fd4565988709d6eea2a8b001b28480101dd7964489f40ad8429097b8e6d738b3f53e798df955c42d4c667083b5068a7df0018220d00a22dae17254800d400d5284801013534bcf339c4e62914974aa062da59042069e643c5b2279ae4fe8a61a9d786660018220d00a14a83fc718800d600d72848010125e9ed7b73768bd05847643a518b94772e590fd354ed7dd104bba4d19b96212a0017220d00a0c6a492d60800d800d9284801014f2604dcb983568a9d952d4336ff263aff62e145c41794a42c87258ef76cc7680015220d00a074a0a3040800da00db220d00a030c680a3c800dc00dd2848010142b21dfd5565772be2ab61d5a9cb89e30a6cc76113f663d1cdfeec25145076a10013220b0088132a81c800de00df284801016d06eea6e62aa8c3299ebe1b1a97a9223e9c721f2881d2ce793b22cee617ba830012220b00850d07d06800e000e128480101bc6addfe7241cb415377c884dbf59a11a65ab79d9324342c0cca2fea1a65ed49000f220b008096ec52e800e200e32848010124e73cf244426297e14bb2301826aeebe62aefa590bef0abc1478564427f7529000a284801010186da0d87ae0c5a636b7fdcd1f2c92a9c14b149a8c08d350dc6ae4215a6ee680009220b00808406a12800e400e5220b00808097b92800e600e7284801014fece73aece9924f80b4e027607f0e4c151b1837a102d488a9e4dd415d76e6bd0006220b00807f11192800e800e928480101cd676820521f90093cd247d76116771cab8947719e87a0db6fd6b3791a068cae000528480101a2188602e8f12725f7accfa873d604fce9bedc6e72f516b3c97bf8716a78b5be0002220b00807eaf712800ea00eb220c600807e1cf5200ec00ed28480101df546910c5ab7de4f6c83f73764055ef10846832b171af991af98bff94a46dab00032199bb7e12c494ce979b54b44ba8608f1981f395ffe7b8d4532729d604036f0a620403ef610979c7bbfb9bc9a42a5850998bbcb829e5538d7d8323469fb01c36c7a32993ea618000001c5889a521c000ee28480101249526b1d16bbcc02d7678abc5a9d6f53dcb45367854f2bc1d052ce1e692c8320001226fc009e121f09624a674bcdaa5a25d430478cc0f9cafff3dc6a299394eb0201b785312288684c345ec4608000000e2c44d291500fbd842534000f000ef219365b001a567000800885413f8ba437c23bae763cc42735f3705e48a9bffd5af1189082c6e46dbc4250012ccd292f7f05e96eead87c40f298af0861c8177119742adbc6a5fd88fe93353a000f0284801014adf48135cb575adbaed476799c87ff2904269b1f949ada4d0479e9104b6f217000602090cf5c5301000f200f30253bfce278d888c6aad6cc86e44413d335d487b0399ffebf495cbba9d04e653da1a1c98208d68198208d6c000f4011b02090ce57e7c1000f500f6010c4606030411ad0129020964cc5b914100f700f802094307f15a0400f900fa0251becef734a05a41cbf608cb90b9427c6cde43bb4d42cf43413ac69de878248dbd098366d78198366d7c0100010a0251befb8b32caee0d5b732f476a2061afdb1988afa9044379b8382d7420dd4717d31195504b01995504b40102010e0245bf3cf50d492161030735ad32018b0f8956a5d12f27c4893ee902b47c228318b8480020011601120251bf358ec21f0259518b8c6a75d051ef59b75ceef872bb2b6b5e7542f01387565310c1fc5680cc1fc56a010401050203641000fd00fe0344bf9d63b087c0965462e31a9d74147bd66dd73bbe1caecadad79d50bc04e1d594c4020104011201030343becef734a05a41cbf608cb90b9427c6cde43bb4d42cf43413ac69de878248dbd08140100010e00ff0343befb8b32caee0d5b732f476a2061afdb1988afa9044379b8382d7420dd4717d310140102010501010207660d9b5f0100010a010c46060306cdaf012702076655412d0102010e110c5236d0a6a6468b3d2a9904ca978e9c176765e9f08891d82735610e478f97a4a5000a4606032aa09601320207660fe2b501040105010c46060307f15a012f13b5f38f77f737934854b0a13317797053caa71afb06468d3f60386d8f465327d4c3000c79e121f09624a674bcdaa5a25d430478cc0f9cafff3dc6a299394eb0201b7853100000038b1134a4374818f8ea362531d63f36cf1f8065d7406ab542a24eb9e493ed9eef6616f008a00000038b000a1c568bd88c100034693d0808012c012d012e02070d06e1d90108010903a3bf842a09fc5d21be11dd73b1e62139af9b82f2454dffead788c4841637236de212325eb472a21504fe2e90df08eeb9d8f3109cd7cdc17922a6fff56bc462420b1b91b6f1094f0000000e2c44d290c97ad1d0010f01100111029bbf412229a71b6641cce1db1df88fb0cb7f83a8d0ae343584cdc5f6862927d41cbe2045009114d38db320e670ed8efc47d865bfc1d468571a1ac266e2fb431493ea0e5fa00000001c5889a5238812010a010c02a3bf57de6d369786f3b6d6d683b5895f3c3d3277705f27faf3d8efbe241aae1baa1868370e852bef369b4bc379db6b6b41dac4af9e1e993bb82f93fd79ec77df120d570dd50ca00000001c5889a5229a0dc3a2010e012203b17009114d38db320e670ed8efc47d865bfc1d468571a1ac266e2fb431493ea0e5f00000038b1134a4797353d9d9d24454745eee4b87c6a473dec3d0572afe1a657e0c069ed44059de700000038af774d8168bd88c1000142048010b010c010d0101a001270082725186162771474eddc8ee87e1ff2d1733e742bc6de90449419390272a5f8e05038691eee24f3d0414946716585640469c3240a86f841252cef52b69d389382f5200130440884049a01830d40213b53e4fdb8e6e61a25a60d3790ee8c3cb96625b3300e38d1fd293d308a5f3f3dc69000b72bef369b4bc379db6b6b41dac4af9e1e993bb82f93fd79ec77df120d570dd50c00000038b1134a450000000000000000000000000000000000000000000000000000000000000000000000000000000068bd88c10005c68370e880121012201230109b264a9e0e801120107d94e2020011b0082720c1d6b488bd7a3b3dc42d2d47260b6db9deca651d2953ef4e0ddbf84607551d45d74c2f3dd9e3ed99a46dde85be4ad8d7fecc402106621d7d2a4d470430357d003b57442a09fc5d21be11dd73b1e62139af9b82f2454dffead788c4841637236de21200000038b1134a41261fb9a845c82723c871a443c2b3404a33544a1f73be990f92b0b8c2a6439f6c00000038b05c2f4168bd88c10003464a9e0e80113011401150201e0011601170082720c1d6b488bd7a3b3dc42d2d47260b6db9deca651d2953ef4e0ddbf84607551d46659739fed2d2c67b5f62760e14a1f46e2731a21d565731ea1f804632a30788a020f0c404618923104400119011a01df8800885413f8ba437c23bae763cc42735f3705e48a9bffd5af1189082c6e46dbc4240654d2c13e6532dede5f99dec3af707d35a9361a9f3635d7cb7dabf47ac411199a8e803f92d6fe74ae59b47a07d4827bd7b1fd91f5d1714e0795bd8a6a88b4d8280f2c0a1b45ec47e8000000281c01180101df012f016842004f090f84b12533a5e6d52d12ea1823c6607ce57ff9ee3514c9ca758100dbc298a01b2e0200000000000000000000000000010131009d41764313880000000000000000108000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020006fc985f5004c0fe298000000000002000000000003ce6f4842245004971d36d2e7e17182dfbd6fe3738b9b084c5f42855e97e55bfa40d02d8c03b37442a09fc5d21be11dd73b1e62139af9b82f2454dffead788c4841637236de21200000038b1134a488e54683c14fbeccf98339d8c83e6bbf58c73f49981af6cf8fa4eca876101dc5a00000038b1134a4168bd88c100014538808011c011d011e0101a001290082726659739fed2d2c67b5f62760e14a1f46e2731a21d565731ea1f804632a30788a5d74c2f3dd9e3ed99a46dde85be4ad8d7fecc402106621d7d2a4d470430357d002130c090063d3d658538811011f0120009a27cbfe3800000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005bc00000000000000000000000012d452da449e50b8cf7dd27861f146122afe1b546bb8b70fc8216f0c614139f8e040201e00132012400827290aec8965afabb16ebc3cb9b408ebae71b618d78788bc80d09843593cac98da40c5180f3dbebc21b3c39db24790aea5ff32f0cf65dbd98734f6515a068d7024e0215040900bc4ddc1867891a11012a012b0201dd012501260101200127010120012901ab680057de6d369786f3b6d6d683b5895f3c3d3277705f27faf3d8efbe241aae1baa190000244534e36cc8399c3b63bf11f6196ff0751a15c686b099b8bed0c524fa8397c404060d9b5e000000716226948cd17b1182c0012801667362d09c000000000000000056760765800800885413f8ba437c23bae763cc42735f3705e48a9bffd5af1189082c6e46dbc425014800c9480057de6d369786f3b6d6d683b5895f3c3d3277705f27faf3d8efbe241aae1baa1900110a827f17486f84775cec79884e6be6e0bc91537ffab5e23121058dc8db788490063d3d640608235a000000716226948ed17b11826a993b6d800000000000000040009e44d2ac07883c0000000000000000bc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006fc98827804c15be900000000000040000000000042f6be2d41ecad466a4ae038cd2f2d9c0b77739dee8d68a18d7b321df0859dc8641103d140201e0012f0130008272bb7376a8f6069862bc440fbf2af09c4f968acbe4535aee21f3eb6c9674fab4ddf6f4c2e44a5ed6bd549f3e1159163135c3eac5728c08251bee27b8c80db6333402170c418900d9701018669302110149014a01b14800885413f8ba437c23bae763cc42735f3705e48a9bffd5af1189082c6e46dbc42500278487c2589299d2f36a9689750c11e3303e72bffcf71a8a64e53ac0806de14c500d970100060fe2b40000007162269484d17b1182c001310101df013201ac0f8a7ea5000000000000000056760765800800012229a71b6641cce1db1df88fb0cb7f83a8d0ae343584cdc5f6862927d41cbf00110a827f17486f84775cec79884e6be6e0bc91537ffab5e23121058dc8db78848203014802b168013c243e12c494ce979b54b44ba8608f1981f395ffe7b8d4532729d604036f0a63000afbcda6d2f0de76dadad076b12be787a64eee0be4ff5e7b1df7c48355c37543100bc4ddc00655412c0000007162269488d17b1183e0013301340201340136013501ab178d4519000000000000000056760765800800885413f8ba437c23bae763cc42735f3705e48a9bffd5af1189082c6e46dbc42500110a827f17486f84775cec79884e6be6e0bc91537ffab5e23121058dc8db78848407014801870800012229a71b6641cce1db1df88fb0cb7f83a8d0ae343584cdc5f6862927d41cbf0012ccd292f7f05e96eead87c40f298af0861c8177119742adbc6a5fd88fe93353a001360114ff00f4a413f4bcf2c80b0137020162013801390202cc013a013b001ba0f605da89a1f401f481f481a8610201d4013c013d020148013e013f00bb0831c02497c138007434c0c05c6c2544d7c0fc02f83e903e900c7e800c5c75c87e800c7e800c00b4c7e08403e29fa954882ea54c4d167c0238208405e3514654882ea58c511100fc02780d60841657c1ef2ea4d67c02b817c12103fcbc2000113e910c1c2ebcb85360020120014001410201200146014701f500f4cffe803e90087c007b51343e803e903e90350c144da8548ab1c17cb8b04a30bffcb8b0950d109c150804d50500f214013e809633c58073c5b33248b232c044bd003d0032c032483e401c1d3232c0b281f2fff274013e903d010c7e801de0063232c1540233c59c3e8085f2dac4f3208405e351467232c7c660014203f73b51343e803e903e90350c0234cffe80145468017e903e9014d6f1c1551cdb5c150804d50500f214013e809633c58073c5b33248b232c044bd003d0032c0327e401c1d3232c0b281f2fff274140371c1472c7cb8b0c2be80146a2860822625a020822625a004ad822860822625a028062849f8c3c975c2c070c008e0014301440145009acb3f5007fa0222cf165006cf1625fa025003cf16c95005cc2391729171e25008a813a08208989680aa008208989680a0a014bcf2e2c504c98040fb001023c85004fa0258cf1601cf16ccc9ed5400705279a018a182107362d09cc8cb1f5230cb3f58fa025007cf165007cf16c9718018c8cb0524cf165006fa0215cb6a14ccc971fb0010241023000e10491038375f040076c200b08e218210d53276db708010c8cb055008cf165004fa0216cb6a12cb1f12cb3fc972fb0093356c21e203c85004fa0258cf1601cf16ccc9ed5400db3b51343e803e903e90350c01f4cffe803e900c145468549271c17cb8b049f0bffcb8b0a0822625a02a8005a805af3cb8b0e0841ef765f7b232c7c572cfd400fe8088b3c58073c5b25c60063232c14933c59c3e80b2dab33260103ec01004f214013e809633c58073c5b3327b55200083200835c87b51343e803e903e90350c0134c7e08405e3514654882ea0841ef765f784ee84ac7cb8b174cfcc7e800c04e81408f214013e809633c58073c5b3327b552000100000000067696674009e44352c08b2900000000000000000ac00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006fc99ff8604c5540a80000000000020000000000037a76c4f31eb7fc2e147f52993b111fd3f9e2acb45f5e2b386d6e86594f3862ea45d0f9743933288f")
            .endCell();
    log.info("CellType {}", c.getCellType());
    Block block = Block.deserialize(CellSlice.beginParse(c));
    log.info("getShardAccountBlocks {}, block {}", block.getExtra().getShardAccountBlocks(), block);
    block.toCell();
    log.info(
        "block, txs {}, msgs {}", block.getAllTransactions().size(), block.getAllMessages().size());

    log.info("blockGson {}", gson.toJson(block));
  }
}
